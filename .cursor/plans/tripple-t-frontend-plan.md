# Tripple T Frontend Development Plan

## Project Overview

A Vue 3 + TypeScript dashboard for managing preform and bottle blowing operations, integrated with a NestJS backend API.

## Completed Features

### 1. Authentication & Security
- ✅ Session-based authentication with CSRF protection
- ✅ JWT token management with automatic refresh
- ✅ First-time login password change flow
- ✅ Redirect to login on token expiration with redirect tracking
- ✅ Password visibility toggle in login form

### 2. Core Components

#### DataTable Component
- ✅ Reusable table with CRUD operations
- ✅ Global debounced search (300ms) built into component
- ✅ Pagination with "X to Y of Z results" display
- ✅ Loading states and error handling
- ✅ Optional Actions column (via `showActions` prop)
- ✅ Horizontal overflow fixes
- ✅ Custom cell rendering via slots

#### Modal Component
- ✅ Reusable modal with title, footer, and slots
- ✅ Disabled buttons during submission (`isSubmitting` prop)
- ✅ Loading spinner on confirm button
- ✅ Title icon slot support
- ✅ 30% opacity overlay for better visibility

#### Alert Component
- ✅ Auto-dismissing alerts (5 seconds default)
- ✅ High z-index (z-100) to appear above modals
- ✅ Success, error, warning, and info types

#### Upload Component
- ✅ File upload with presigned URLs (S3)
- ✅ Support for images and PDFs
- ✅ Image cropping with Cropper.js
- ✅ Upload progress tracking
- ✅ File name input
- ✅ Automatic upload record creation after S3 upload
- ✅ Emits full upload object with ID

#### ViewUploadModal Component
- ✅ Reusable modal for viewing uploaded files
- ✅ Presigned download URL generation
- ✅ CORS-safe file loading (blob + object URL)
- ✅ Image and PDF preview support
- ✅ File type icons in title
- ✅ Loading and error states

### 3. Configuration Management

#### Products
- ✅ CRUD operations
- ✅ API-populated dropdowns for Size, Colour, Unit (sorted)
- ✅ Product type icons (Bottle, Cap, Preform, Nylon, Other)
- ✅ Product name display (auto-generated by backend)
- ✅ Type column with icon representation

#### Suppliers & Customers
- ✅ Updated to new backend structure:
  - `business_name`, `contact_person_*` fields
  - Optional `contact_person_email`
  - Status toggle for edit (not in create)
  - State dropdown from `nigerian-states.json`
- ✅ Horizontal overflow fixes

### 4. Accounting Section

#### Expenses
- ✅ CRUD operations
- ✅ Date-only input for `reported_at` (using `date-fns`)
- ✅ Naira currency masking with prepend
- ✅ Sorted category badges with color coding
- ✅ Category dropdown sorted alphabetically

#### Purchase Records
- ✅ Create multiple purchase records per invoice
- ✅ Single `purchased_at` date for all records
- ✅ Searchable supplier selection with loader
- ✅ Searchable product selection with loader
- ✅ Product type icons in dropdown and table
- ✅ Duplicate product prevention across records
- ✅ Optional invoice upload (new or existing)
- ✅ Currency masking for price per bag
- ✅ Total amount display at form bottom
- ✅ "Add Record" button at bottom with auto-scroll
- ✅ Upload ID handling (not upload object)

### 5. File Management

#### Uploads Section
- ✅ View all uploaded files
- ✅ File type icons and labels
- ✅ File size formatting (KB, MB, GB)
- ✅ View file modal integration
- ✅ Search with debouncing
- ✅ No actions column (view-only)

### 6. Utilities

#### File Type Utilities (`src/utils/file-types.ts`)
- ✅ `getFileTypeIcon()` - Returns icon component for MIME type
- ✅ `getFileTypeIconClass()` - Returns color classes
- ✅ `getFileTypeLabel()` - Returns user-friendly labels
- ✅ Supports: Images, PDFs, Videos, Audio, Archives, Code, Office docs

#### Product Type Utilities (`src/utils/product-types.ts`)
- ✅ `getProductTypeIcon()` - Returns icon component for product type
- ✅ `getProductTypeIconClass()` - Returns color classes
- ✅ Icons: Bottle (blue), Cap (green), Preform (purple), Nylon (orange), Other (gray)

### 7. Date Handling
- ✅ Consistent use of `date-fns` for all date operations
- ✅ `fromUnixTime()` for converting timestamps to Date objects
- ✅ `getUnixTime()` for converting Date objects to timestamps
- ✅ `format()` for date formatting

### 8. UI/UX Improvements
- ✅ Search loaders for suppliers, products, and uploads
- ✅ Button disabling during form submissions
- ✅ Auto-scroll to "Add Record" button
- ✅ Total amount calculation and display
- ✅ Currency formatting with Naira symbol
- ✅ Product type icons throughout
- ✅ File type icons in uploads table and modals

## Technical Decisions

### State Management
- Pinia stores for global state (auth, alerts, configuration)
- Local component state for forms and UI state
- Computed properties for derived state

### API Integration
- Service layer pattern (one service per entity)
- Base API service with interceptors
- Automatic token refresh on 401
- CSRF token handling
- Error handling with user-friendly alerts

### Date Handling
- All dates stored as Unix timestamps (numbers)
- `date-fns` for all date conversions and formatting
- Date inputs use `type="date"` for date-only fields

### File Uploads
- Presigned URLs for S3 uploads
- Upload record created after successful S3 upload
- Only `upload_id` sent in requests (not full upload object)
- CORS-safe file viewing via blob + object URL

### Search & Filtering
- 300ms debounce on all search inputs
- Global debounce implementation in DataTable component
- Search loaders for visual feedback
- Duplicate prevention for product selection

## File Structure

```
src/
├── components/
│   ├── accounting/
│   │   ├── ExpensesTable.vue
│   │   └── PurchaseRecordsTable.vue
│   ├── common/
│   │   ├── Alert.vue
│   │   ├── DataTable.vue
│   │   ├── Modal.vue
│   │   ├── Upload.vue
│   │   └── ViewUploadModal.vue
│   ├── configuration/
│   │   ├── ColorsTable.vue
│   │   ├── CustomersTable.vue
│   │   ├── ProductsTable.vue
│   │   ├── SizesTable.vue
│   │   ├── SuppliersTable.vue
│   │   └── UnitsTable.vue
│   ├── layout/
│   │   ├── Layout.vue
│   │   └── Sidebar.vue
│   └── uploads/
│       └── UploadsTable.vue
├── data/
│   └── nigerian-states.json
├── services/
│   ├── accounting.ts
│   ├── base.api.ts
│   ├── expenses.service.ts
│   ├── purchase-records.service.ts
│   ├── uploads.service.ts
│   └── [other entity services]
├── stores/
│   ├── accounting.ts
│   ├── alert.ts
│   ├── auth.ts
│   └── configuration.ts
├── types/
│   └── index.ts
├── utils/
│   ├── file-types.ts
│   └── product-types.ts
└── views/
    ├── Accounting.vue
    ├── ChangePassword.vue
    ├── Configuration.vue
    ├── Dashboard.vue
    ├── Login.vue
    ├── ThirdParties.vue
    └── Uploads.vue
```

## Key Routes

- `/login` - Login page
- `/change-password` - First-time password change
- `/` - Dashboard
- `/configuration/:tab` - Products, Colors, Sizes, Units
- `/third-parties/:tab` - Suppliers, Customers
- `/accounting/:tab` - Expenses, Purchase Records
- `/uploads` - File uploads management

## Environment Variables

- `VITE_API_BASE_URL` - Base URL for API v1 endpoints
- `VITE_API_APP_BASE_URL` - Base URL for app endpoints (CSRF, health)
- `VITE_FILE_BASE_URL` - Base URL for file access (if needed)

## Dependencies

- Vue 3 (Composition API)
- TypeScript
- Pinia
- Vue Router 4
- Axios
- Tailwind CSS v4
- Heroicons
- date-fns
- cropperjs
- uuid

## Future Considerations

- Testing strategy (unit tests, integration tests, E2E)
- Performance optimizations
- Additional features as requirements evolve
- Documentation updates

